<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamic Flashing LED Display</title>
    <style>
      /* Reset and Basic Styles */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
        width: 100%;
        background-color: #000; /* Black background */
        display: flex;
        align-items: center;
        justify-content: center;
      }

      /* LED Display Container */
      .led-display {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(7, 1fr);
        gap: 5%; /* Gap as a percentage for responsiveness */
        width: 80vw; /* Occupies 80% of the viewport width */
        max-width: 600px; /* Maximum width for larger screens */
        aspect-ratio: 5 / 7; /* Maintains the grid's aspect ratio */
      }

      /* Individual Dot */
      .dot {
        background-color: #0f0; /* Green color */
        border-radius: 50%;
        opacity: 0; /* Hidden by default */
        width: 100%;
        height: 100%;
        transition: opacity 0.3s;
      }

      /* Active Dots */
      .dot.active {
        opacity: 1; /* Fully visible */
        animation: flash 0.3s infinite; /* Flashing animation */
      }

      /* Flashing Animation */
      @keyframes flash {
        0%,
        50%,
        100% {
          opacity: 1;
        }
        25%,
        75% {
          opacity: 0.3;
        }
      }

      /* Responsive Adjustments */
      @media (max-width: 600px) {
        .led-display {
          width: 90vw; /* Occupies 90% of the viewport width on smaller screens */
          gap: 3%; /* Smaller gaps for tighter grids */
        }
      }
    </style>
  </head>
  <body>
    <div class="led-display" id="ledDisplay">
      <!-- 5 columns x 7 rows = 35 dots -->
      <!-- Dots are ordered row-wise from top-left to bottom-right -->
      <!-- Total dots: 35 -->
      <!-- Initialize with 'A' active dots -->
      <!-- Row 1 -->
      <div class="dot"></div>
      <!-- 1 -->
      <div class="dot active"></div>
      <!-- 2 -->
      <div class="dot active"></div>
      <!-- 3 -->
      <div class="dot active"></div>
      <!-- 4 -->
      <div class="dot"></div>
      <!-- 5 -->
      <!-- Row 2 -->
      <div class="dot active"></div>
      <!-- 6 -->
      <div class="dot"></div>
      <!-- 7 -->
      <div class="dot"></div>
      <!-- 8 -->
      <div class="dot"></div>
      <!-- 9 -->
      <div class="dot active"></div>
      <!-- 10 -->
      <!-- Row 3 -->
      <div class="dot active"></div>
      <!-- 11 -->
      <div class="dot"></div>
      <!-- 12 -->
      <div class="dot"></div>
      <!-- 13 -->
      <div class="dot"></div>
      <!-- 14 -->
      <div class="dot active"></div>
      <!-- 15 -->
      <!-- Row 4 -->
      <div class="dot active"></div>
      <!-- 16 -->
      <div class="dot active"></div>
      <!-- 17 -->
      <div class="dot active"></div>
      <!-- 18 -->
      <div class="dot active"></div>
      <!-- 19 -->
      <div class="dot active"></div>
      <!-- 20 -->
      <!-- Row 5 -->
      <div class="dot active"></div>
      <!-- 21 -->
      <div class="dot"></div>
      <!-- 22 -->
      <div class="dot"></div>
      <!-- 23 -->
      <div class="dot"></div>
      <!-- 24 -->
      <div class="dot active"></div>
      <!-- 25 -->
      <!-- Row 6 -->
      <div class="dot active"></div>
      <!-- 26 -->
      <div class="dot"></div>
      <!-- 27 -->
      <div class="dot"></div>
      <!-- 28 -->
      <div class="dot"></div>
      <!-- 29 -->
      <div class="dot active"></div>
      <!-- 30 -->
      <!-- Row 7 -->
      <div class="dot active"></div>
      <!-- 31 -->
      <div class="dot"></div>
      <!-- 32 -->
      <div class="dot"></div>
      <!-- 33 -->
      <div class="dot"></div>
      <!-- 34 -->
      <div class="dot active"></div>
      <!-- 35 -->
    </div>

    <script>
      // Define the dot-matrix patterns for letters A, C, T
      const LETTERS = {
        A: ["01110", "10001", "10001", "11111", "10001", "10001", "10001"],
        C: ["01110", "10001", "10000", "10000", "10000", "10001", "01110"],
        T: ["11111", "00100", "00100", "00100", "00100", "00100", "00100"],
      };

      const ledDisplay = document.getElementById("ledDisplay");
      const totalDots = 35; // 5 columns x 7 rows

      // Function to clear all active dots
      function clearDots() {
        for (let i = 0; i < totalDots; i++) {
          ledDisplay.children[i].classList.remove("active");
        }
      }

      // Function to render a specific letter
      function renderLetter(letter) {
        clearDots();
        const pattern = LETTERS[letter];
        if (!pattern) return;

        for (let row = 0; row < 7; row++) {
          for (let col = 0; col < 5; col++) {
            const index = row * 5 + col;
            if (pattern[row][col] === "1") {
              ledDisplay.children[index].classList.add("active");
            }
          }
        }
      }

      // Function to hide the display (all dots off)
      function hideDisplay() {
        clearDots();
      }

      // Function to handle device orientation
      function handleOrientation(event) {
        const beta = event.beta; // Left-right tilt in degrees, range [-180,180]
        // console.log('Beta:', beta); // For debugging

        if (beta >= 80 && beta <= 85) {
          hideDisplay();
        } else if (beta < 80) {
          renderLetter("C");
        } else if (beta >= 85 && beta < 95) {
          renderLetter("A");
        } else if (beta >= 95 && beta <= 100) {
          hideDisplay();
        } else if (beta > 100) {
          renderLetter("T");
        }
      }

      // Initialize with 'A'
      renderLetter("A");

      // Request device orientation permission for iOS 13+
      function initOrientation() {
        if (
          typeof DeviceOrientationEvent !== "undefined" &&
          typeof DeviceOrientationEvent.requestPermission === "function"
        ) {
          DeviceOrientationEvent.requestPermission()
            .then((permissionState) => {
              if (permissionState === "granted") {
                window.addEventListener("deviceorientation", handleOrientation);
              } else {
                alert("Permission to access device orientation was denied.");
              }
            })
            .catch(console.error);
        } else if (window.DeviceOrientationEvent) {
          window.addEventListener("deviceorientation", handleOrientation);
        } else {
          alert("Device Orientation not supported.");
        }
      }

      // Add a button to request orientation permissions on iOS if necessary
      if (
        typeof DeviceOrientationEvent !== "undefined" &&
        typeof DeviceOrientationEvent.requestPermission === "function"
      ) {
        // Create a button
        const permissionButton = document.createElement("button");
        permissionButton.textContent = "Enable Motion Access";
        permissionButton.style.position = "absolute";
        permissionButton.style.top = "20px";
        permissionButton.style.left = "50%";
        permissionButton.style.transform = "translateX(-50%)";
        permissionButton.style.padding = "10px 20px";
        permissionButton.style.fontSize = "16px";
        permissionButton.style.border = "none";
        permissionButton.style.borderRadius = "5px";
        permissionButton.style.backgroundColor = "#28a745";
        permissionButton.style.color = "#fff";
        permissionButton.style.cursor = "pointer";
        permissionButton.style.zIndex = "1000";
        permissionButton.style.display = "none"; // Initially hidden

        // Check if permission is needed
        window.addEventListener("DOMContentLoaded", () => {
          // Some browsers require a user interaction to start listening
          window.addEventListener(
            "click",
            () => {
              permissionButton.style.display = "none";
              initOrientation();
            },
            { once: true }
          );

          // Show the button if not already granted
          if (
            typeof DeviceOrientationEvent !== "undefined" &&
            typeof DeviceOrientationEvent.requestPermission === "function"
          ) {
            DeviceOrientationEvent.requestPermission()
              .then((permissionState) => {
                if (permissionState === "granted") {
                  initOrientation();
                } else {
                  // Show the button to request permission on user interaction
                  permissionButton.style.display = "block";
                }
              })
              .catch(() => {
                // Show the button to request permission on user interaction
                permissionButton.style.display = "block";
              });
          }
        });

        document.body.appendChild(permissionButton);
      } else {
        // If no permission is needed or supported, initialize orientation
        window.addEventListener("DOMContentLoaded", initOrientation);
      }
    </script>
  </body>
</html>
